{
    "$defs": {
        "awsResourceTagValue": {
            "$comment": "Restrictions based on https://docs.aws.amazon.com/general/latest/gr/aws_tagging.html#tag-conventions",
            "maxLength": 256,
            "minLength": 0,
            "pattern": "^[ a-zA-Z0-9\\._:/=+-@]+$",
            "title": "Tag value",
            "type": "string"
        },
        "machinePool": {
            "properties": {
                "availabilityZones": {
                    "items": {
                        "title": "Availability zone",
                        "type": "string"
                    },
                    "title": "Availability zones",
                    "type": "array"
                },
                "customNodeLabels": {
                    "items": {
                        "title": "Label",
                        "type": "string"
                    },
                    "title": "Custom node labels",
                    "type": "array"
                },
                "customNodeTaints": {
                    "items": {
                        "properties": {
                            "effect": {
                                "enum": [
                                    "NoSchedule",
                                    "PreferNoSchedule",
                                    "NoExecute"
                                ],
                                "title": "Effect",
                                "type": "string"
                            },
                            "key": {
                                "title": "Key",
                                "type": "string"
                            },
                            "value": {
                                "title": "Value",
                                "type": "string"
                            }
                        },
                        "required": [
                            "effect",
                            "key",
                            "value"
                        ],
                        "type": "object"
                    },
                    "title": "Custom node taints",
                    "type": "array"
                },
                "instanceType": {
                    "title": "EC2 instance type",
                    "type": "string"
                },
                "maxSize": {
                    "title": "Maximum number of nodes",
                    "type": "integer"
                },
                "minSize": {
                    "title": "Minimum number of nodes",
                    "type": "integer"
                },
                "rootVolumeSizeGB": {
                    "title": "Root volume size (GB)",
                    "type": "integer"
                },
                "subnetTags": {
                    "description": "Tags to filter which AWS subnets will be used for this node pool.",
                    "items": {
                        "additionalProperties": {
                            "$ref": "#/$defs/awsResourceTagValue"
                        },
                        "title": "Subnet tag",
                        "type": "object"
                    },
                    "title": "Subnet tags",
                    "type": "array"
                }
            },
            "title": "Node pool",
            "type": "object"
        }
    },
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "properties": {
        "aws": {
            "properties": {
                "awsClusterRole": {
                    "$comment": "Please use /providerSpecific/awsClusterRoleIdentityName.",
                    "deprecated": true,
                    "title": "Cluster role",
                    "type": "string"
                }
            },
            "title": "AWS settings",
            "type": "object"
        },
        "baseDomain": {
            "title": "Base DNS domain",
            "type": "string"
        },
        "connectivity": {
            "properties": {
                "bastion": {
                    "properties": {
                        "enabled": {
                            "default": true,
                            "title": "Enable",
                            "type": "boolean"
                        },
                        "instanceType": {
                            "default": "t3.small",
                            "title": "EC2 instance type",
                            "type": "string"
                        },
                        "replicas": {
                            "default": 1,
                            "title": "Number of hosts",
                            "type": "integer"
                        },
                        "subnetTags": {
                            "description": "Tags to filter which AWS subnets will be used for the bastion hosts.",
                            "items": {
                                "additionalProperties": {
                                    "$ref": "#/$defs/awsResourceTagValue"
                                },
                                "title": "Subnet tag",
                                "type": "object"
                            },
                            "title": "Subnet tags",
                            "type": "array"
                        }
                    },
                    "title": "Bastion host",
                    "type": "object"
                },
                "containerRegistries": {
                    "additionalProperties": {
                        "description": "Container registries and mirrors",
                        "items": {
                            "properties": {
                                "credentials": {
                                    "properties": {
                                        "auth": {
                                            "description": "Base64-encoded string from the concatenation of the username, a colon, and the password.",
                                            "title": "Auth",
                                            "type": "string"
                                        },
                                        "identitytoken": {
                                            "description": "Used to authenticate the user and obtain an access token for the registry.",
                                            "title": "Identity token",
                                            "type": "string"
                                        },
                                        "password": {
                                            "description": "Used to authenticate for the registry with username/password.",
                                            "title": "Password",
                                            "type": "string"
                                        },
                                        "username": {
                                            "description": "Used to authenticate for the registry with username/password.",
                                            "title": "Username",
                                            "type": "string"
                                        }
                                    },
                                    "title": "Credentials",
                                    "type": "object"
                                },
                                "endpoint": {
                                    "description": "Endpoint for the container registry.",
                                    "title": "Endpoint",
                                    "type": "string"
                                }
                            },
                            "required": [
                                "endpoint"
                            ],
                            "title": "Registry",
                            "type": "object"
                        },
                        "title": "Registries",
                        "type": "array"
                    },
                    "description": "Endpoints and credentials configuration for container registries.",
                    "title": "Container registries",
                    "type": "object"
                },
                "network": {
                    "properties": {
                        "serviceCidr": {
                            "default": "172.31.0.0/16",
                            "description": "IPv4 address range for services, in CIDR notation.",
                            "title": "Service subnet",
                            "type": "string"
                        }
                    },
                    "title": "Network",
                    "type": "object"
                }
            },
            "title": "Connectivity",
            "type": "object"
        },
        "controlPlane": {
            "properties": {
                "containerdVolumeSizeGB": {
                    "default": 100,
                    "title": "Containerd volume size (GB)",
                    "type": "integer"
                },
                "etcdVolumeSizeGB": {
                    "default": 100,
                    "title": "Etcd volume size (GB)",
                    "type": "integer"
                },
                "instanceType": {
                    "default": "m5.xlarge",
                    "title": "EC2 instance type",
                    "type": "string"
                },
                "kubeletVolumeSizeGB": {
                    "default": 100,
                    "title": "Kubelet volume size (GB)",
                    "type": "integer"
                },
                "machineHealthCheck": {
                    "properties": {
                        "enabled": {
                            "default": true,
                            "title": "Enable",
                            "type": "boolean"
                        },
                        "maxUnhealthy": {
                            "default": "40%",
                            "examples": [
                                "40%"
                            ],
                            "title": "Maximum unhealthy nodes",
                            "type": "string"
                        },
                        "nodeStartupTimeout": {
                            "default": "8m0s",
                            "description": "Determines how long a machine health check should wait for a node to join the cluster, before considering a machine unhealthy.",
                            "examples": [
                                "10m",
                                "100s"
                            ],
                            "title": "Node startup timeout",
                            "type": "string"
                        },
                        "unhealthyNotReadyTimeout": {
                            "default": "10m0s",
                            "description": "If a node is not in condition 'Ready' after this timeout, it will be considered unhealthy.",
                            "examples": [
                                "300s"
                            ],
                            "title": "Timeout for ready",
                            "type": "string"
                        },
                        "unhealthyUnknownTimeout": {
                            "default": "10m0s",
                            "description": "If a node is in 'Unknown' condition after this timeout, it will be considered unhealthy.",
                            "examples": [
                                "300s"
                            ],
                            "title": "Timeout for unknown condition",
                            "type": "string"
                        }
                    },
                    "title": "Machine health check",
                    "type": "object"
                },
                "oidc": {
                    "properties": {
                        "caPem": {
                            "description": "Identity provider's CA certificate in PEM format.",
                            "title": "Certificate authority",
                            "type": "string"
                        },
                        "clientId": {
                            "title": "Client ID",
                            "type": "string"
                        },
                        "groupsClaim": {
                            "title": "Groups claim",
                            "type": "string"
                        },
                        "issuerUrl": {
                            "description": "Exact issuer URL that will be included in identity tokens.",
                            "title": "Issuer URL",
                            "type": "string"
                        },
                        "usernameClaim": {
                            "title": "Username claim",
                            "type": "string"
                        }
                    },
                    "title": "OIDC authentication",
                    "type": "object"
                },
                "rootVolumeSizeGB": {
                    "default": 120,
                    "title": "Root volume size (GB)",
                    "type": "integer"
                },
                "subnetTags": {
                    "description": "Tags to select AWS resources for the control plane by.",
                    "items": {
                        "additionalProperties": {
                            "$ref": "#/$defs/awsResourceTagValue"
                        },
                        "title": "Subnet tag",
                        "type": "object"
                    },
                    "title": "Subnet tags",
                    "type": "array"
                }
            },
            "title": "Control plane",
            "type": "object"
        },
        "defaultMachinePools": {
            "default": {
                "def00": {
                    "customNodeLabels": [
                        "label=default"
                    ],
                    "instanceType": "m5.xlarge",
                    "minSize": 3
                }
            },
            "patternProperties": {
                "^[a-z0-9]{5,10}$": {
                    "$ref": "#/$defs/machinePool"
                }
            },
            "title": "Default node pool",
            "type": "object"
        },
        "hashSalt": {
            "description": "If specified, this token is used as a salt to the hash suffix of some resource names. Can be used to force-recreate some resources.",
            "title": "Hash salt",
            "type": "string"
        },
        "includeClusterResourceSet": {
            "default": true,
            "title": "Include ClusterResourceSet",
            "type": "boolean"
        },
        "kubectlImage": {
            "properties": {
                "name": {
                    "default": "giantswarm/kubectl",
                    "title": "Repository",
                    "type": "string"
                },
                "registry": {
                    "default": "quay.io",
                    "title": "Registry",
                    "type": "string"
                },
                "tag": {
                    "default": "1.23.5",
                    "title": "Tag",
                    "type": "string"
                }
            },
            "title": "Kubectl image",
            "type": "object"
        },
        "kubernetesVersion": {
            "default": "1.23.16",
            "examples": [
                "1.24.7"
            ],
            "title": "Kubernetes version",
            "type": "string"
        },
        "machinePools": {
            "patternProperties": {
                "^[a-z0-9]{5,10}$": {
                    "$ref": "#/$defs/machinePool"
                }
            },
            "title": "Node pools",
            "type": "object"
        },
        "metadata": {
            "properties": {
                "description": {
                    "description": "User-friendly description of the cluster's purpose.",
                    "title": "Cluster description",
                    "type": "string"
                },
                "name": {
                    "description": "Unique identifier, cannot be changed after creation.",
                    "title": "Cluster name",
                    "type": "string"
                },
                "organization": {
                    "title": "Organization",
                    "type": "string"
                }
            },
            "title": "Metadata",
            "type": "object"
        },
        "network": {
            "properties": {
                "apiMode": {
                    "default": "public",
                    "description": "Whether the Kubernetes API server load balancer should be reachable from the internet (public) or internal only (private).",
                    "enum": [
                        "public",
                        "private"
                    ],
                    "title": "API mode",
                    "type": "string"
                },
                "availabilityZoneUsageLimit": {
                    "default": 3,
                    "description": "Maximum number of availability zones (AZ) that should be used in a region. If a region has more than this number of AZs then this number of AZs will be picked randomly when creating subnets.",
                    "title": "Availability zones",
                    "type": "integer"
                },
                "dnsAssignAdditionalVPCs": {
                    "description": "If DNS mode is 'private', the VPCs specified here will be assigned to the private hosted zone. Separate multiple entries with comma.",
                    "examples": [
                        "vpc-98injA",
                        "vpc-x2aeasd1d,vpc-98injA"
                    ],
                    "title": "DNS assign additional VPCs",
                    "type": "string"
                },
                "dnsMode": {
                    "default": "public",
                    "description": "Whether the Route53 hosted zone of this cluster should be public or private.",
                    "enum": [
                        "public",
                        "private"
                    ],
                    "title": "DNS mode",
                    "type": "string"
                },
                "podCIDR": {
                    "default": "100.64.0.0/12",
                    "description": "IPv4 address range for pods, in CIDR notation.",
                    "title": "Pod subnet",
                    "type": "string"
                },
                "prefixListID": {
                    "description": "ID of the managed prefix list to use when the topology mode is set to 'UserManaged'.",
                    "title": "Prefix list ID",
                    "type": "string"
                },
                "resolverRulesOwnerAccount": {
                    "description": "ID of the AWS account that created the resolver rules to be associated with the workload cluster VPC.",
                    "oneOf": [
                        {
                            "pattern": "^\\d{12}$"
                        },
                        {
                            "const": ""
                        }
                    ],
                    "title": "Resolver rules owner",
                    "type": "string"
                },
                "subnets": {
                    "default": [
                        {
                            "cidrBlocks": [
                                {
                                    "availabilityZone": "a",
                                    "cidr": "10.0.0.0/20"
                                },
                                {
                                    "availabilityZone": "b",
                                    "cidr": "10.0.16.0/20"
                                },
                                {
                                    "availabilityZone": "c",
                                    "cidr": "10.0.32.0/20"
                                }
                            ],
                            "isPublic": true
                        },
                        {
                            "cidrBlocks": [
                                {
                                    "availabilityZone": "a",
                                    "cidr": "10.0.64.0/18"
                                },
                                {
                                    "availabilityZone": "b",
                                    "cidr": "10.0.128.0/18"
                                },
                                {
                                    "availabilityZone": "c",
                                    "cidr": "10.0.192.0/18"
                                }
                            ],
                            "isPublic": false
                        }
                    ],
                    "items": {
                        "properties": {
                            "cidrBlocks": {
                                "items": {
                                    "properties": {
                                        "availabilityZone": {
                                            "examples": [
                                                "a"
                                            ],
                                            "title": "Availability zone",
                                            "type": "string"
                                        },
                                        "cidr": {
                                            "description": "IPv4 address range, in CIDR notation.",
                                            "title": "Address range",
                                            "type": "string"
                                        },
                                        "tags": {
                                            "additionalProperties": {
                                                "$ref": "#/$defs/awsResourceTagValue"
                                            },
                                            "description": "AWS resource tags to assign to this subnet.",
                                            "title": "Tags",
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                },
                                "title": "Network",
                                "type": "array"
                            },
                            "isPublic": {
                                "title": "Public",
                                "type": "boolean"
                            },
                            "tags": {
                                "additionalProperties": {
                                    "$ref": "#/$defs/awsResourceTagValue"
                                },
                                "description": "AWS resource tags to assign to this CIDR block.",
                                "title": "Tags",
                                "type": "object"
                            }
                        },
                        "title": "Subnet",
                        "type": "object"
                    },
                    "title": "Subnets",
                    "type": "array"
                },
                "topologyMode": {
                    "default": "None",
                    "description": "Defines the type of cross-cluster networking architecture between management and workload cluster. Valid values: GiantSwarmManaged, UserManaged, None.",
                    "enum": [
                        "None",
                        "GiantSwarmManaged",
                        "UserManaged"
                    ],
                    "title": "Topology mode",
                    "type": "string"
                },
                "transitGatewayID": {
                    "description": "If the topology mode is set to 'UserManaged', this can be used to specify the transit gateway to use.",
                    "title": "Transit gateway ID",
                    "type": "string"
                },
                "vpcCIDR": {
                    "default": "10.0.0.0/16",
                    "description": "IPv4 address range to assign to this cluster's VPC, in CIDR notation.",
                    "title": "VPC subnet",
                    "type": "string"
                },
                "vpcEndpointMode": {
                    "default": "GiantSwarmManaged",
                    "description": "Who is reponsible for creation and management of VPC endpoints.",
                    "enum": [
                        "GiantSwarmManaged",
                        "UserManaged"
                    ],
                    "title": "VPC endpoint mode",
                    "type": "string"
                },
                "vpcMode": {
                    "default": "public",
                    "description": "Whether the cluser's VPC is created with public, internet facing resources (public subnets, NAT gateway) or not (private).",
                    "enum": [
                        "public",
                        "private"
                    ],
                    "title": "VPC mode",
                    "type": "string"
                }
            },
            "title": "Network",
            "type": "object"
        },
        "organization": {
            "title": "Organization",
            "type": "string"
        },
        "providerSpecific": {
            "properties": {
                "ami": {
                    "description": "If specified, this image will be used to provision EC2 instances.",
                    "title": "Amazon machine image (AMI)",
                    "type": "string"
                },
                "awsClusterRoleIdentityName": {
                    "$comment": "See also https://cluster-api-aws.sigs.k8s.io/topics/multitenancy.html#awsclusterroleidentity",
                    "default": "default",
                    "description": "Name of an AWSClusterRoleIdentity object. This in turn refers to the IAM role used to create all AWS cloud resources when creating the cluster. The role can be in another AWS account in order to create all resources in that account. Note: This name does not refer directly to an IAM role name/ARN.",
                    "maxLength": 63,
                    "minLength": 1,
                    "pattern": "^[-a-zA-Z0-9_\\.]{1,63}$",
                    "title": "Cluster role identity name",
                    "type": "string"
                },
                "flatcarAwsAccount": {
                    "default": "075585003325",
                    "description": "AWS account ID owning the Flatcar Container Linux AMI.",
                    "title": "AWS account owning Flatcar image",
                    "type": "string"
                },
                "region": {
                    "title": "Region",
                    "type": "string"
                }
            },
            "title": "AWS settings",
            "type": "object"
        },
        "proxy": {
            "description": "Whether/how outgoing traffic is routed through proxy servers.",
            "properties": {
                "enabled": {
                    "title": "Enable",
                    "type": "boolean"
                },
                "http_proxy": {
                    "description": "To be passed to the HTTP_PROXY environment variable in all hosts.",
                    "title": "HTTP proxy",
                    "type": "string"
                },
                "https_proxy": {
                    "description": "To be passed to the HTTPS_PROXY environment variable in all hosts.",
                    "title": "HTTPS proxy",
                    "type": "string"
                },
                "no_proxy": {
                    "description": "To be passed to the NO_PROXY environment variable in all hosts.",
                    "title": "No proxy",
                    "type": "string"
                }
            },
            "title": "Proxy",
            "type": "object"
        },
        "sshSSOPublicKey": {
            "default": "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIM4cvZ01fLmO9cJbWUj7sfF+NhECgy+Cl0bazSrZX7sU vault-ca@vault.operations.giantswarm.io",
            "title": "SSH public key for single sign-on",
            "type": "string"
        }
    },
    "type": "object"
}
