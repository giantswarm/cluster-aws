[plugins."io.containerd.grpc.v1.cri".registry]
  [plugins."io.containerd.grpc.v1.cri".registry.mirrors]
    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
{{- if .Values.harborRegistry -}}
      endpoint = ["{{ .Values.harborRegistry.username }}"", "https://registry-1.docker.io", "giantswarm.azurecr.io"]
{{- else -}}
      endpoint = ["https://registry-1.docker.io", "giantswarm.azurecr.io"]
{{- end -}}
  [plugins."io.containerd.grpc.v1.cri".registry.configs]
    [plugins."io.containerd.grpc.v1.cri".registry.configs."registry-1.docker.io".auth]
      auth = "{{ tpl "{{ .Values.registry.username }}:{{ .Values.registry.password }}" . | b64enc }}"
    {{- if .Values.harborRegistry -}}
    [plugins."io.containerd.grpc.v1.cri".registry.configs.{{ .Values.harborRegistry.url}}.auth]
      auth = "{{ tpl "{{ .Values.harborRegistry.username }}:{{ .Values.harborRegistry.password }}" . | b64enc }}"
    {{- end -}}
